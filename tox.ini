[tox]
envlist=py35,py36,py37
[testenv]
deps=coverage
commands =
    # Create HTML coverage report for humans and xml coverage report for external services.
    coverage run --source=pytest_workflow -m py.test -v tests -m 'not functional'
    coverage html
    coverage xml

[testenv:py3-lint]
deps=flake8
     flake8-import-order
     bandit
     pylint
     mypy
commands =
    flake8 src tests setup.py
    # Skip 'assert used' issue as this is a pytest plugin.'
    # Use csv format because it has cleanest output.
    bandit -s B101 -f csv -r src/ tests/
    pylint src/pytest_workflow/ tests/ setup.py
    mypy -m src/pytest_workflow

# Documentation should build on python version 3
[testenv:py3-docs]
deps=-r requirements-docs.txt
whitelist_externals=bash
                    make
commands=
    python --version
    # Test if documentation can be build without errors
    make --directory=docs html
    # Test if version correctly shows up in documentation
    bash -c 'set -eux; grep -r "$(python setup.py --version)" docs/_build/'

[testenv:py3-snakemake]
deps=snakemake
commands =
    python -m pytest tests/functional/test_snakemake.py

[testenv:py3-cromwell]
deps=snakemake
commands =
    python -m pytest tests/functional/test_cromwell.py
